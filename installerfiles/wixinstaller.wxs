<?xml version="1.0"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
   <Product Id="*" UpgradeCode="12345678-1234-1234-1234-111111111111" 
            Name="!(loc.ApplicationName)" Version="0.5.7" Manufacturer="!(loc.ManufacturerName)" Language="1033">
      <Package InstallerVersion="300" Compressed="yes" Comments="Windows Installer Package"/>
      <Media Id="1" Cabinet="easytournament.cab" EmbedCab="yes"/>
	  <Icon Id="ProductIcon" SourceFile="../res/icons/start.ico"/>
      <Property Id="ARPPRODUCTICON" Value="ProductIcon"/>
      <Property Id="ARPHELPLINK" Value="http://www.easy-tournament.com"/>
      <Property Id="ARPURLINFOABOUT" Value="http://www.easy-tournament.com"/>
      <Property Id="ARPNOREPAIR" Value="1"/>
      <Property Id="ARPNOMODIFY" Value="1"/>
	  <!-- Check some requirements ONLY on "install", but not on modify or uninstall. -->
	  <Property Id="JAVA_CURRENT_VERSION">
		<RegistrySearch Id="JRE_CURRENT_VERSION_REGSEARCH" Root="HKLM" Key="SOFTWARE\JavaSoft\Java Runtime Environment" Name="CurrentVersion" Type="raw" />
	  </Property>
	  <Condition Message="!(loc.JREError)"><![CDATA[Installed OR (JAVA_CURRENT_VERSION >= "1.6")]]></Condition>
	  <Upgrade Id="19345678-1234-1234-1234-222222222222">
         <UpgradeVersion Minimum="0.5.7" OnlyDetect="yes" Property="NEWERVERSIONDETECTED"/>
         <UpgradeVersion Minimum="0.0.0" Maximum="0.5.7" IncludeMinimum="yes" IncludeMaximum="no" 
                         Property="OLDERVERSIONBEINGUPGRADED"/>	  
      </Upgrade>
      <Condition Message="!(loc.VersionError)">NOT NEWERVERSIONDETECTED</Condition>
 
      <Directory Id="TARGETDIR" Name="SourceDir">
         <Directory Id="ProgramFilesFolder">
            <Directory Id="INSTALLDIR" Name="!(loc.ApplicationName)">
               <Component Id="ApplicationFiles" Guid="12345678-1234-1234-1234-222222222222" KeyPath="yes" >
                  <File Id="StartFile" Source="../Release/EasyTournament.exe"/>
				  <File Id="ReadmeFile" Source="../README.txt"/>
				  <File Id="LicenseFile" Source="../LICENSE.txt"/>
               </Component>
			   <Directory Id="helpdir" Name ="help">
				   <Component Id="helpFolder" Guid="13345678-1234-1234-1234-222222222222" KeyPath="yes"> 
						<CreateFolder /> 
					</Component> 
				</Directory>
				<Directory Id="resdir" Name ="res">
				   <Component Id="resFolder" Guid="14345678-1234-1234-1234-222222222222" KeyPath="yes"> 
						<CreateFolder /> 
					</Component> 
				</Directory>
				<Directory Id="libdir" Name ="lib">
				   <Component Id="libFolder" Guid="15345678-1234-1234-1234-222222222222" KeyPath="yes"> 
						<CreateFolder /> 
					</Component> 
				</Directory>
				<Directory Id="sportsdir" Name ="sports">
				   <Component Id="sportsFolder" Guid="16345678-1234-1234-1234-222222222222" KeyPath="yes"> 
						<CreateFolder /> 
					</Component> 
				</Directory>
            </Directory>
         </Directory>
		 
		 <Directory Id="ProgramMenuFolder">
            <Directory Id="ProgramMenuSubfolder" Name="!(loc.ApplicationName)">
               <Component Id="ApplicationShortcuts" Guid="12845678-1234-1234-1234-333333333333">
                  <Shortcut Id="ApplicationShortcut1" Name="!(loc.ApplicationName)" Description="!(loc.ApplicationName)" 
                            Target="[INSTALLDIR]!(loc.ApplicationName).exe" WorkingDirectory="INSTALLDIR"/>
                  <Shortcut Id="UninstallProduct"             
						    Name="Uninstall"
						    Description="Uninstalls !(loc.ApplicationName)"
						    Target="[System64Folder]msiexec.exe"
						    Arguments="/x [ProductCode]"/>
				  <RegistryValue Root="HKCU" Key="Software\!(loc.ManufacturerName)\!(loc.ApplicationName)" 
                            Name="installed" Type="integer" Value="1" KeyPath="yes"/>
                  <RemoveFolder Id="ProgramMenuSubfolder" On="uninstall"/>
               </Component>
            </Directory>
         </Directory>
      </Directory>
	  
	  <InstallExecuteSequence>
         <RemoveExistingProducts After="InstallValidate"/>
      </InstallExecuteSequence>
	  	  
	  <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="!(loc.LaunchET)" />
	  <UI>
		<UIRef Id="WixUI_Mondo" />
		<UIRef Id="WixUI_ErrorProgressText" />
		<Publish Dialog="ExitDialog"
		Control="Finish" 
		Event="DoAction" 
		Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
	  </UI>
	  
	  <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
	  
	  <Property Id="WixShellExecTarget" Value="[#EasyTournament.exe]" />
	  <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />
 
      <Feature Id="Complete" Title="!(loc.ApplicationName) 0.5.7" Description="!(loc.CompleteDesc)" Display="expand" Level="1" ConfigurableDirectory='INSTALLDIR'>
		<Feature Id='MainProgram' Title='Program' Description='The main executable.' Level='1'>
			<ComponentRef Id="helpFolder"/>
			<ComponentRef Id="resFolder"/>
			<ComponentRef Id="libFolder"/>
			<ComponentRef Id="sportsFolder"/>
			<ComponentRef Id="ApplicationFiles"/>
			<ComponentGroupRef Id="helpFiles"/>
			<ComponentGroupRef Id="resFiles"/>
			<ComponentGroupRef Id="libFiles"/>
			<ComponentGroupRef Id="sportsFiles"/>
			<ComponentRef Id="ApplicationShortcuts"/>
		</Feature>
      </Feature>
	  
	  <Icon Id="EasyTournament.exe" SourceFile="../Release/EasyTournament.exe" />
   </Product>
</Wix>
  